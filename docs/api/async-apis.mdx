---
sidebar_position: 8
title: Asynchronous APIs
---

# Asynchronous APIs

Some API operations can take a while to complete. For these APIs, Permit will run them in the background after the request
is complete. When an asynchronous API is called, you will receive a `202 Accepted` response, with a unique `task_id` in
response body. You can use this ID to check the status of the task, and to retrieve a result when the task is completed
successfully, or an error if the task failed.

Some operations offer both an asynchronous and a synchronous call, for backwards compatibility. The default behavior is
to use the synchronous call, but you can request an asynchronous call by setting the `?async=true` URL parameter.

## Calling an asynchronous API
The `Delete Environment` API is an example of an asynchronous-optional API. To call this API, you can use the following
curl command:

```shell
$ curl -v -X DELETE "https://api.permit.io/v2/projects/{project_id}/envs/{environment_id}"
> DELETE /v2/projects/{project_id}/envs/{environment_id} HTTP/1.1
>
< HTTP/1.1 204 No Content
<
```

To call the same API asynchronously, you can use the following curl command:
```shell
$ curl -v -X DELETE "https://api.permit.io/v2/projects/{project_id}/envs/{environment_id}?async=true"
> DELETE /v2/projects/{project_id}/envs/{environment_id} HTTP/1.1
>
< HTTP/1.1 202 Accepted
< Content-Type: application/json
< Location: /v2/tasks/{task_id}
<
{
  "task_id": "{task_id}"
}
```

## Checking the status of a task

To check the status of a task, you can use the following curl command:

```shell
$ curl -v "https://api.permit.io/v2/tasks/{task_id}"
> GET /v2/tasks/{task_id} HTTP/1.1
>
< HTTP/1.1 200 OK
< Content-Type: application/json
{
    "id": "{task_id",
    "operation_name": "delete_environment",
    "status": "finished",
    "created_at": "2024-05-05T18:06:09+00:00",
    "started_at": "2024-05-05T18:06:09+00:00",
    "finished_at": "2024-05-05T18:06:09+00:00",
    "environment_id": "{environment_id}",
    "project_id": "{project_id}",
    "organization_id": "{organization_id}"
}
```

By default, the error or result of the task is not returned in the response. You can use the `?include_result=true` URL
to retrieve it:

```shell
$ curl -v "https://api.permit.io/v2/tasks/{task_id}?include_result=true
> GET /v2/tasks/{task_id} HTTP/1.1
>
< HTTP/1.1 200 OK
< Content-Type: application/json
{
    "id": "{task_id}",
    "operation_name": "delete_environment",
    "status": "finished",
    "created_at": "2024-05-05T18:06:09+00:00",
    "started_at": "2024-05-05T18:06:09+00:00",
    "finished_at": "2024-05-05T18:06:09+00:00",
    "environment_id": "{environment_id}",
    "project_id": "{project_id}",
    "organization_id": "{organization_id}",
    "result": null
}
```

The `delete_environment` API does not return a response, so the `result` field is `null`. The `result` field will contain
the response of the API operation when the task is completed successfully. If the operation failed, the `error` field
will contain the error message.
